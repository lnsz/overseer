#!/bin/sh

tag='latest'
port='4000'
user='postgres'
env='development'
while [ "$#" -ne 0 ]; do
  case "$1" in
    '--registry'   ) registry="$2/"  ;;
    '--tag'        ) tag="$2"        ;;
    '--user'       ) user="$2"       ;;
    '--password'   ) password="$2"   ;;
    '--port'       ) port="$2"       ;;
    '--env'        ) env="$2"        ;;
  esac
  shift 2
done

export DB_USERNAME="$user"
export DB_PASSWORD="$password"
export EXTERNAL_PORT="$port"
export RAILS_ENV="$env"
export OVERSEER_IMAGE="${registry}overseer:$tag"

docker volume create overseer_db
rm tmp/pids/server.pid
docker kill overseer && docker rm overseer
docker kill overseer_db && docker rm overseer_db
docker-compose -f docker/docker-compose.yml up